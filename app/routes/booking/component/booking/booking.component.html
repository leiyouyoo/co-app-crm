<div class="inner-content py-20" id="table">
  <div class="list-content main-container">
    <div class="index-header-title">
      <!-- <form nz-form #formData="ngForm"> -->
      <div class="index-header-title-filter">
        <nz-select nzAllowClear
          [nzPlaceHolder]="'Please search for the booking operator / booking business name' | translate"
          (modelWithGroupChange)="bookingInputParams.bookingNoOrName = $event.groupValue"
          class="index-header-title-filter-perple" [(ngModel)]="bookingInputParams.bookingNoOrName" nzShowSearch>
          <nz-option [groupValue]="item" *ngFor="let item of bookingNoList" [nzValue]="item"
            [nzLabel]="item.searchContent"></nz-option>
        </nz-select>
        <nz-select nzAllowClear nzShowSearch [nzPlaceHolder]="'Search for entrusted customers / contacts' | translate"
          (modelWithGroupChange)="bookingInputParams.customerOrContact = $event.groupValue"
          class="index-header-title-filter-perple" [(ngModel)]="bookingInputParams.customerOrContact">
          <nz-option [groupValue]="item" *ngFor="let item of customerOrContactList" [nzValue]="item"
            [nzLabel]="item.searchContent"></nz-option>
        </nz-select>
        <nz-select nzAllowClear [nzPlaceHolder]="'Status' | translate" class="index-header-title-filter-status"
          [(ngModel)]="bookingInputParams.Status">
          <nz-option *ngFor="let item of bookingStateList" [nzValue]="item" [nzLabel]="bookingState[item] | translate">
          </nz-option>
        </nz-select>
        <div class="icon-all">
          <!-- <label>{{ 'Company' | translate }}：</label> -->
          <nz-radio-group [nzButtonStyle]="'solid'" class="tradeTypeGroup nz-radio-group-button"
            [(ngModel)]="bookingInputParams.IsDistributeServiceCompany">
            <label class="tradeTypeInfo" nz-radio-button [nzValue]="false">{{ 'Pending assign' | translate }}</label>
            <label class="tradeTypeInfo" nz-radio-button [nzValue]="true">{{ 'Assigned' | translate }}</label>
          </nz-radio-group>
        </div>
        <button nz-button nzType="primary" [disabled]="isDisabled" (click)="search()">
          {{ 'Search' | translate }}
        </button>
        <button nz-button nzType="Default" (click)="bookingInputParams = {}">
          {{ 'Clear' | translate }}
        </button>
      </div>
      <!-- </form> -->
      <div class="list-content-action">
        <button nz-button nzType="primary" [disabled]="isDisabled" (click)="addBooking()">
          {{ 'Create Booking' | translate }}
        </button>
      </div>
    </div>
    <div class="content-list">
      <nz-spin [nzSpinning]="loading" nzTip="Loading..." style="flex: 1; overflow: auto;">
        <nz-table #rowSelectionTable [nzShowPagination]="false" [nzData]="bookingList" [nzTotal]="bookingtotal"
          [nzPageSize]="pageinationParams.nzPageSize"  disableCalcX class="height-100"
          calcNzTableBodyScroll>
          <thead>
            <tr>
              <th><span style="display: inline-block; min-width: 30px;"></span>{{ 'BookNo' | translate }}</th>
              <th nzWidth="130px">
                {{ 'BookName' | translate }}
              </th>
              <th nzWidth="120px">
                {{ 'Freight Type' | translate }}
              </th>
              <th nzShowSort [(nzSort)]="mapOfSort.CargoReadydate" (nzSortChange)="sort('CargoReadydate', $event)">
                {{ 'cargo ready date' | translate }}
              </th>
              <th>
                {{ 'Shipper' | translate }}
              </th>
              <th>
                {{ 'Consignee' | translate }}
              </th>
              <th nzWidth="130px">
                {{ 'Cargo Detail' | translate }}
              </th>
              <th>
                {{ 'BookStatus' | translate }}
              </th>
              <th>
                {{ 'Company' | translate }}
              </th>
              <th>
                {{ 'Action' | translate }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of rowSelectionTable.data; let i = index"
              [ngClass]="{ ou: i % 2 == 0, ji: i % 2 != 0 }">
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                <span style="display: inline-block; min-width: 30px;">
                  <span *ngIf="data.isCustomerUpdate" [title]="'客户修改了订舱申请,详见详情页'" class="iconfont icon-gengxin"></span>
                </span>
                {{ data.bookingNo }}
              </td>
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                {{ data.name }}
              </td>
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                <ng-container
                  *ngIf="data.freightMethodType == freightMethodTypeValue.Ocean; else freighttypeElseTemplate">
                  {{ 'ocean' | translate }}
                </ng-container>
                <ng-template #freighttypeElseTemplate>
                  {{ 'air' | translate }}
                </ng-template>
              </td>
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                <ng-container *ngIf="data.cargoReadyDate; else elsecargoReadyDateTemplate">
                  {{ data.cargoReadyDate | date: 'yyy-MM-dd' }}
                </ng-container>
                <ng-template #elsecargoReadyDateTemplate>
                  ---
                </ng-template>
              </td>
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                <ul *ngIf="data.originAddress">
                  <li>
                    {{ data.originAddress?.customerName }}
                  </li>
                  <li>
                    <span *ngIf="data.originAddress">
                      {{ data.originAddress?.city }}
                      <span *ngIf="data.originAddress.country">,</span>{{ data.originAddress?.country }}
                    </span>
                  </li>
                </ul>
              </td>
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                <ng-container *ngIf="data.destinationAddress; else elsedestinationAddressTemplate">
                  <ul *ngIf="data.destinationAddress">
                    <li>
                      <ng-container *ngIf="data.destinationAddress.customerName; else elsedestinationTemplate">
                        {{ data.destinationAddress?.customerName }}
                      </ng-container>
                      <ng-template #elsedestinationTemplate>
                        {{ data.destinationAddress?.name }}
                      </ng-template>
                    </li>
                    <li>
                      <span *ngIf="data.destinationAddress">
                        {{ data.destinationAddress?.streetAddress }}

                        {{ data.destinationAddress?.city }}
                        <span *ngIf="data.destinationAddress.city">,</span>{{ data.destinationAddress?.country }}
                      </span>
                    </li>
                  </ul>
                </ng-container>
                <ng-template #elsedestinationAddressTemplate>
                  ---
                </ng-template>
              </td>
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                <ng-container *ngIf="data.totalWeightDisplay && data.totalVolumeDisplay; else elseWeightTemplate">
                  <ul>
                    <li>{{ data.totalWeightDisplay }}</li>
                    <li>{{ data.totalVolumeDisplay }}</li>
                  </ul>
                </ng-container>
                <ng-template #elseWeightTemplate>
                  ---
                </ng-template>
              </td>
              <td [ngClass]="{ errorBorder: data.status == 1 }">
                <span *ngIf="data.status == 0">
                  {{ 'Dreft' | translate }}
                </span>
                <span *ngIf="data.status == 1">
                  {{ 'Pending cancel' | translate }}
                </span>
                <span *ngIf="data.status == 7">
                  {{ 'Cancelled' | translate }}
                </span>
                <span *ngIf="data.status == 2">
                  {{ 'BookingSubmitted' | translate }}
                </span>
                <span *ngIf="data.status == 3">
                  {{ 'Booked' | translate }}
                </span>
                <span *ngIf="data.status == 4">
                  {{ 'Waiting for price' | translate }}
                </span>
                <span *ngIf="data.status == 5">
                  {{ 'Waiting for the customer to confirm the price' | translate }}
                </span>
                <span *ngIf="data.status == 6">
                  {{ 'Waiting for the customer to confirm the price' | translate }}
                </span>
              </td>
              <td class="td_name">
                <span *ngIf="data.serviceCompanyId">
                  {{ data.serviceCompanyDisplay }}
                </span>
                <div *ngIf="!data.serviceCompanyId" style="min-width: 80px;">
                  <nz-select style="width: 80%;" [(ngModel)]="data.serviceCompanyId" nzAllowClear nzShowSearch
                    [appSearchByExtraKey]="['displayNameLocalization','displayName']" [nzCustomTemplate]="companyCustom"
                    nzPlaceHolder="{{ 'Choose' | translate }}" (nzOpenChange)="getServiceCompany(data)"
                    (ngModelChange)="SureServiceCompany(data)">
                    <nz-option [appNzOptionExtra]="item" [nzValue]="item.id" [nzLabel]="item.displayNameLocalization"
                      *ngFor="let item of companylist"></nz-option>
                  </nz-select>
                  <ng-template #companyCustom let-selected>
                    <div>
                      {{ selected.template._appExtra.displayNameLocalization }}
                    </div>
                  </ng-template>
                </div>
              </td>
              <td class="actiontd">
                <button *ngIf="data.status != 0" nz-button nzType="primary" (click)="view(data)">
                  {{ 'View' | translate }}
                </button>
                <button nz-button nzType="default" class="Editbutton" (click)="editRouter(data, 'isEdit')"
                  *ngIf="data.status == 0 && data.creatorUserId === userId">
                  {{ 'Edit' | translate }}
                </button>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </nz-spin>
    </div>
    <div class="d-flex justify-content-end">
      <nz-pagination style="text-align: right;" #nzpage [nzPageIndex]="pageinationParams.pageIndex"
        [nzShowSizeChanger]="true" [nzTotal]="bookingtotal"
        (nzPageSizeChange)="nzpage.nzPageIndex = 1; currentPageSizeChange($event)"
        [nzPageSize]="pageinationParams.nzPageSize" (nzPageIndexChange)="pageIndexChange($event)"
        [nzShowQuickJumper]="false">
      </nz-pagination>
    </div>
  </div>
</div>