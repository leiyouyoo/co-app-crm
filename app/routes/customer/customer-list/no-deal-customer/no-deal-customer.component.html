<div class="crm-body" id="body-list">
  <div class="search">
    <div>
      <div class="search-header">
        <nz-input-group [nzSuffix]="suffixIconSearch">
          <input
            type="text"
            nz-input
            placeholder="{{ 'Please enter key words' | translate }}"
            [(ngModel)]="searchData"
            (keyup)="onSearch($event)"
          />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <i nz-icon nzType="search" (click)="nowSearch()"></i>
        </ng-template>
      </div>
    </div>

    <div class="button-head">
      <button class="button" nz-button [disabled]="choosedData.length === 0" (click)="transModal()">
        {{ 'Transfer' | translate }}
      </button>

      <button class="button" nz-button [nzType]="'primary'" (click)="createModal()">
        {{ 'New' | translate }}
      </button>
      <button class="button" nz-button [nzType]="'primary'" (click)="showMerge()">
        {{ 'customer merge' | translate }}
      </button>
    </div>
  </div>

  <div class="body-list">
    <co-st
      style="height: 100%;"
      #st
      [data]="listOfData?.items"
      [columns]="columns"
      [showFilters]="false"
      [total]="listOfData?.totalCount"
      [loading]="loading"
      (change)="checkChange($event)"
      [page]="{ front: false }"
      [(ps)]="maxResultCount"
      calcScroll
      disableCalcX
    >
      <ng-template st-row="CustomerTableName" let-data>
        <a (click)="showDetial(data)">
          {{ data.name || '--' }}

          <span *ngIf="data.isMerged">({{ 'merged customers' | translate }})</span></a
        >
      </ng-template>
    </co-st>
  </div>
</div>

<nz-modal
  nzMaskClosable="false"
  [(nzVisible)]="isVisibleCreate"
  nzTitle="{{ 'New customer' | translate }}"
  [nzFooter]="cusFooter"
  nzOkText="Save"
  nzWidth="50%"
  (nzOnCancel)="createCancel()"
>
  <div #createCustomer></div>
  <ng-template #cusFooter>
    <button nz-button (click)="create(true)" [nzLoading]="applicationLoading" [disabled]="cusLoading">
      {{ 'Application' | translate }}
    </button>

    <button nz-button nzType="primary" (click)="create()" [disabled]="applicationLoading" [nzLoading]="cusLoading">
      {{ 'Save' | translate }}
    </button>
  </ng-template>
</nz-modal>

<nz-modal
  nzMaskClosable="false"
  [(nzVisible)]="isVisibleTrans"
  nzTitle="{{ 'Transfer customer' | translate }}"
  [nzFooter]="tranFooter"
  (nzOnCancel)="cancelTrans()"
  nzOkText="{{ 'Transfer' | translate }}"
  nzCancelText="{{ 'Cancel' | translate }}"
  nzWidth="50%"
>
  <transfer-tocustomer></transfer-tocustomer>
  <ng-template #tranFooter>
    <button nz-button nzType="primary" (click)="createTrans()" [nzLoading]="tranLoading">
      {{ 'Transfer' | translate }}
    </button>
  </ng-template>
</nz-modal>

<!-- 删除 -->
<nz-modal
  nzMaskClosable="false"
  [(nzVisible)]="isDelete"
  [nzTitle]="modalOneText"
  (nzOnCancel)="cancelDelete()"
  (nzOnOk)="customerDelete()"
  nzOkText="{{ 'OK' | translate }}"
  [nzOkLoading]="errLoading"
  nzCancelText="{{ 'Cancel' | translate }}"
>
  {{ modalOneContent }}
</nz-modal>

<nz-modal
  nzMaskClosable="false"
  [(nzVisible)]="unDelete"
  [nzTitle]="modalTwoText"
  (nzOnCancel)="cancelDeleteCustomer()"
  (nzOnOk)="cancelDeleteCustomer()"
  nzOkText="{{ 'OK' | translate }}"
  [nzFooter]="modalFooter"
  [nzContent]="modalTwoContent"
>
</nz-modal>

<ng-template #modalContent>
  {{ modalTwoContent }}
</ng-template>

<ng-template #modalFooter>
  <button nz-button nzType="primary" (click)="cancelDeleteCustomer()">{{ 'OK' | translate }}</button>
</ng-template>
<app-customer-merge (getCustomerByPageList)="getCustomerByPageList()"></app-customer-merge>
