<div class="crm-body" id="body-list">
  <div class="search">
    <div>
      <div class="search-header">
        <nz-input-group [nzSuffix]="suffixIconSearch">
          <input
            type="text"
            nz-input
            placeholder="{{ 'Please enter key words' | translate }}"
            [(ngModel)]="searchData"
            (keyup)="onSearch($event)"
          />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <i nz-icon nzType="search" (click)="nowSearch()"></i>
        </ng-template>
      </div>
    </div>

    <div class="button-head">
      <button class="button" nz-button [nzType]="'primary'" (click)="showMerge()">
        {{ 'customer merge' | translate }}
      </button>
      <button nz-button (click)="onShareModal()" nzType="primary">
        <i nz-icon nzType="menu-fold" nzTheme="outline"></i>{{ 'Shared resource library' | translate }}
      </button>
    </div>
  </div>

  <div class="body-list">
    <nz-table
      #rowSelectionTable3
      [nzData]="listOfData?.items"
      [nzLoading]="loading"
      [nzFrontPagination]="false"
      nzShowPagination="false"
      nzTableLayout="fixed"
      calcScroll
    >
      <thead>
        <tr>
          <th nzWidth="50px">
            <label nz-checkbox nzShowCheckbox [(nzChecked)]="isAllDisplayDataChecked" (nzCheckedChange)="checkAll($event)"></label>
          </th>
          <th [nzShowSort]="false" nzColumnKey="CustomerName" nzWidth="500px">
            {{ 'CustomerTableName' | translate }}
          </th>
          <th [nzShowSort]="false" nzColumnKey="CountryProvince" nzWidth="150px">
            {{ 'Country, province' | translate }}
          </th>
          <th [nzShowSort]="false" nzColumnKey="Contact" nzWidth="150px">
            {{ 'Contact' | translate }}
          </th>
          <th [nzShowSort]="false" nzColumnKey="Tel" nzWidth="150px">
            {{ 'Phone' | translate }}
          </th>
          <th [nzShowSort]="false" nzColumnKey="Owner" nzWidth="150px">
            {{ 'First shipment time' | translate }}
          </th>
          <th [nzShowSort]="false" nzColumnKey="CustomerName" nzWidth="150px">
            {{ 'Sharer' | translate }}
          </th>
          <th nzRight="0" nzWidth="100px">
            {{ 'Operating' | translate }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let data of rowSelectionTable3.data; let i = index"
          [ngClass]="{ ou: i % 2 == 0, ji: i % 2 != 0 }"
          (dblclick)="showDetial(data)"
        >
          <td nzEllipsis>
            <label nz-checkbox nzShowCheckbox [(nzChecked)]="data.choosed" (nzCheckedChange)="refreshStatus()"></label>
          </td>
          <td nzEllipsis nzBreakWord style="color: #7297ff;">
            <a [routerLink]="['/crm/customers/shareddetial', data.id]">
              {{ data.name || '--' }}<span *ngIf="data.isMerged">({{ 'merged customers' | translate }})</span></a
            >
          </td>
          <td nzEllipsis nzBreakWord>
            {{ data.country }}&nbsp;{{ data.province }} <span *ngIf="!data.country && !data.province">--</span>
          </td>
          <td nzEllipsis nzBreakWord>
            {{ data.contactName || '--' }}
          </td>
          <td nzEllipsis nzBreakWord>
            {{ data.contactTel || '--' }}
          </td>
          <td nzEllipsis nzBreakWord>
            {{ data.firsttimeShipDate || '--' }}
          </td>
          <td nzEllipsis nzBreakWord>
            <button
              *ngIf="data.sharedUsers.length > 0"
              nz-button
              nz-popover
              nzPopoverTitle=""
              [nzPopoverContent]="contentTemplate"
              nzPopoverPlacement="bottomRight"
              nzSize="small"
            >
              {{ '+' + data.sharedUsers.length }}
            </button>
            <span *ngIf="data.sharedUsers.length == 0">--</span>
            <ng-template #contentTemplate>
              <div *ngFor="let item of data.sharedUsers">
                <div>{{ item.userName || '--' }}</div>
              </div>
            </ng-template>
          </td>
          <td nzEllipsis nzBreakWord nzRight="0">
            <a [routerLink]="['/crm/customers/shareddetial', data.id]">{{ 'View' | translate }}</a>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>

  <div class="pagination">
    <nz-pagination
      [nzPageIndex]="skipCount"
      [nzPageSize]="maxResultCount"
      nzShowQuickJumper
      nzShowSizeChanger
      nzHideOnSinglePage
      [nzTotal]="listOfData?.totalCount"
      (nzPageSizeChange)="pageSizeChange($event)"
      (nzPageIndexChange)="pageIndexChange($event)"
    ></nz-pagination>
  </div>

  <nz-modal
    nzMaskClosable="false"
    [(nzVisible)]="isVisible"
    nzTitle="{{ 'Shared resource library' | translate }}"
    (nzOnCancel)="isVisible = false; customerInfo = null"
    [nzOkText]="null"
    nzWidth="80%"
    style="position: relative;"
    [nzFooter]="null"
  >
    <div class="modal-content share-resources-modal">
      <div class="left">
        <div style="display: flex; margin-bottom: 24px;">
          <nz-select
            nzPlaceHolder="{{ 'Please enter key words' | translate }}"
            [(ngModel)]="shareInputName"
            nzShowSearch
            style="width: 100% !important;"
            (nzOnSearch)="searchCustomer($event)"
            nzServerSearch
            nzAllowClear
          >
            <nz-option *ngFor="let option of customList" [nzLabel]="option.name" [nzValue]="option.id"> </nz-option>
          </nz-select>
          <button nz-button (click)="getTableData()" [nzLoading]="tableLoading" nzType="primary" style="margin-left: 24px;">
            {{ 'Search' | translate }}
          </button>
        </div>

        <nz-table
          #basicTable
          [nzData]="tableDatas?.items"
          [nzLoading]="tableLoading"
          [nzFrontPagination]="false"
          nzShowPagination="false"
          nzTableLayout="fixed"
          nzWidth="300"
          [nzScroll]="{ x: '800px', y: '300px' }"
        >
          <thead>
            <tr>
              <th nzEllipsis nzWidth="150px">{{ 'CustomerTableName' | translate }}</th>
              <th nzEllipsis nzWidth="150px">{{ 'Country, province' | translate }}</th>
              <th nzEllipsis nzWidth="150px">{{ 'Contact' | translate }}</th>
              <th nzEllipsis nzWidth="150px">{{ 'Phone' | translate }}</th>
              <th nzEllipsis nzWidth="150px">{{ 'First shipment time' | translate }}</th>
              <th nzEllipsis nzWidth="150px">{{ 'Sharer' | translate }}</th>
              <th nzEllipsis nzWidth="100px" nzRight="0">{{ 'Operating' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let data of basicTable.data; let i = index"
              [ngClass]="{ ou: i % 2 == 0, ji: i % 2 != 0 }"
              (click)="getCustomerById(data.id)"
            >
              <td nzEllipsis>{{ data.name }}</td>
              <td nzEllipsis>{{ data.country }}-{{ data.province }}</td>
              <td nzEllipsis>{{ data.contactName || '--' }}</td>
              <td nzEllipsis>{{ data.contactTel || '--' }}</td>
              <td nzEllipsis>{{ data.firsttimeShipDate || '--' }}</td>
              <td nzEllipsis>
                <button
                  nz-button
                  nz-popover
                  class="redButton"
                  nzPopoverTitle=""
                  [nzPopoverContent]="contentTemplate"
                  nzPopoverPlacement="bottomRight"
                  nzSize="small"
                  *ngIf="data.sharedUsers"
                >
                  {{ '+' + data.sharedUsers.length }}
                </button>
                <ng-template #contentTemplate>
                  <div *ngFor="let item of data.sharedUsers">
                    <p>{{ item.userName }}</p>
                  </div>
                </ng-template>
              </td>
              <td nzEllipsis nzRight="0">
                <div>
                  <a (click)="onBindCustomer(data)">{{ 'follow up' | translate }}</a>
                </div>
              </td>
            </tr>
          </tbody>
        </nz-table>

        <div class="pagination" *ngIf="tableDatas">
          <nz-pagination
            [nzPageIndex]="tableSkipCount"
            [nzPageSize]="tableMaxResultCount"
            (nzPageIndexChange)="tablePageIndexChange($event)"
            [nzTotal]="tableDatas?.totalCount"
          ></nz-pagination>
        </div>
      </div>

      <div class="right" *ngIf="customerInfo">
        <crm-customer-source [customerInfo]="customerInfo" style="width: 100%;"></crm-customer-source>
      </div>
    </div>

    <!-- <div style="width:500px;">
  </div> -->
  </nz-modal>
</div>
<app-customer-merge (getCustomerByPageList)="getSharesList()"></app-customer-merge>
